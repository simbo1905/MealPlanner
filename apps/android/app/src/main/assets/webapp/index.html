<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MealPlanner Recipes</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 16px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .header {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 24px;
      text-align: center;
      margin-bottom: 16px;
    }
    .header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 8px;
    }
    .header p {
      font-size: 14px;
      color: #6c757d;
    }
    .add-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      margin-bottom: 16px;
    }
    .add-section h2 {
      font-size: 18px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 12px;
    }
    .add-section textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      margin-bottom: 12px;
    }
    .add-section textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    .add-section button {
      width: 100%;
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .add-section button:active {
      transform: translateY(1px);
    }
    .recipes-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .recipe-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .recipe-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    }
    .recipe-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      position: relative;
    }
    .recipe-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .recipe-meta {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 14px;
      opacity: 0.95;
    }
    .recipe-body {
      padding: 20px;
    }
    .recipe-description {
      font-size: 15px;
      color: #495057;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    .recipe-notes {
      font-size: 14px;
      color: #6c757d;
      font-style: italic;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 12px;
    }
    .recipe-section {
      margin-bottom: 16px;
    }
    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 8px;
    }
    .section-list {
      list-style: none;
      padding: 0;
    }
    .section-list li {
      padding: 6px 0;
      font-size: 14px;
      color: #495057;
      border-bottom: 1px solid #e9ecef;
    }
    .section-list li:last-child {
      border-bottom: none;
    }
    .ingredients-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .ingredient-name {
      font-weight: 500;
    }
    .ingredient-amount {
      color: #667eea;
      font-size: 13px;
    }
    .steps-list {
      list-style: decimal;
      padding-left: 20px;
    }
    .steps-list li {
      padding: 8px 0;
      line-height: 1.5;
    }
    .delete-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      padding: 8px 16px;
      background: rgba(220, 53, 69, 0.9);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .delete-btn:hover {
      background: rgba(200, 35, 51, 1);
    }
    .delete-btn:active {
      transform: scale(0.95);
    }
    .empty-state {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      text-align: center;
      padding: 60px 20px;
      color: #6c757d;
    }
    .empty-state p {
      font-size: 18px;
      margin-bottom: 8px;
    }
    .allergen-badge {
      display: inline-block;
      padding: 2px 8px;
      background: #ffc107;
      color: #212529;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>MealPlanner</h1>
      <p>Browse your favorite recipes (localStorage)</p>
    </div>
    
    <div class="add-section">
      <h2>Add Recipe</h2>
      <textarea id="recipeJsonInput" placeholder='Paste recipe JSON here, e.g.:
{
  "title": "My Recipe",
  "image_url": "https://example.com/image.jpg",
  "description": "A delicious meal",
  "notes": "Serve hot",
  "pre_reqs": ["Preheat oven"],
  "total_time": 30,
  "ingredients": [{"name": "ingredient", "ucum-unit": "cup_us", "ucum-amount": 1, "metric-unit": "g", "metric-amount": 100, "notes": ""}],
  "steps": ["Step 1", "Step 2"]
}'></textarea>
      <button id="addRecipeBtn">Add Recipe</button>
    </div>
    
    <div class="recipes-list" id="recipesList">
      <div class="empty-state">
        <p>Loading recipes...</p>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'mealplanner_recipes';

    function getInitialRecipes() {
      return [
        {"id":"1","title":"Spaghetti Bolognese","image_url":"https://example.com/images/spaghetti-bolognese.jpg","description":"Classic spaghetti with rich, savory meat sauce simmered with herbs and tomato.","notes":"Best served with grated cheese and fresh basil.","pre_reqs":["Boil water for pasta","Preheat pan for sauce"],"total_time":45,"ingredients":[{"name":"spaghetti","ucum-unit":"cup_us","ucum-amount":4,"metric-unit":"g","metric-amount":400,"notes":"dry pasta","allergen-code":"GLUTEN"},{"name":"minced beef","ucum-unit":"cup_us","ucum-amount":2,"metric-unit":"g","metric-amount":300,"notes":"browned"},{"name":"tomato sauce","ucum-unit":"cup_us","ucum-amount":2,"metric-unit":"ml","metric-amount":480,"notes":"simmered with herbs"},{"name":"onion","ucum-unit":"cup_us","ucum-amount":0.5,"metric-unit":"g","metric-amount":75,"notes":"chopped finely"}],"steps":["Cook spaghetti in salted boiling water until al dente.","Sauté onion until translucent, then add minced beef and brown.","Add tomato sauce and simmer for 20 minutes.","Combine pasta and sauce, toss to coat, and serve hot."]},
        {"id":"2","title":"Chicken Stir-Fry","image_url":"https://example.com/images/chicken-stirfry.jpg","description":"Quick and colorful chicken stir-fry with vegetables and savory soy sauce.","notes":"Serve immediately to keep vegetables crisp.","pre_reqs":["Prepare and chop all vegetables","Heat wok or large frying pan on high heat"],"total_time":30,"ingredients":[{"name":"chicken breast","ucum-unit":"cup_us","ucum-amount":2,"metric-unit":"g","metric-amount":250,"notes":"sliced thinly"},{"name":"soy sauce","ucum-unit":"tbsp_us","ucum-amount":2,"metric-unit":"ml","metric-amount":30,"notes":"added for flavor","allergen-code":"SOY"},{"name":"mixed vegetables","ucum-unit":"cup_us","ucum-amount":3,"metric-unit":"g","metric-amount":350,"notes":"bite-sized pieces"}],"steps":["Heat oil in a wok over high heat.","Add chicken and stir-fry until nearly cooked through.","Add vegetables and stir-fry for 3–4 minutes.","Pour in soy sauce, toss to coat, and serve hot."]},
        {"id":"3","title":"Fish and Chips","image_url":"https://example.com/images/fish-and-chips.jpg","description":"Crispy battered fish with golden fries, a classic comfort meal.","notes":"Serve with tartar sauce or malt vinegar.","pre_reqs":["Preheat oil for frying to 350°F (175°C)"],"total_time":40,"ingredients":[{"name":"white fish fillet","ucum-unit":"cup_us","ucum-amount":2,"metric-unit":"g","metric-amount":300,"notes":"cut into portions","allergen-code":"FISH"},{"name":"flour","ucum-unit":"cup_us","ucum-amount":1,"metric-unit":"g","metric-amount":120,"notes":"used for batter","allergen-code":"GLUTEN"},{"name":"potatoes","ucum-unit":"cup_us","ucum-amount":4,"metric-unit":"g","metric-amount":500,"notes":"cut into fries"}],"steps":["Coat fish in flour and dip in batter.","Fry fish until golden brown and cooked through.","Fry potatoes until crisp and golden.","Drain on paper towels and serve hot."]},
        {"id":"4","title":"Vegetable Curry","image_url":"https://example.com/images/vegetable-curry.jpg","description":"A fragrant curry packed with mixed vegetables in a rich coconut sauce.","notes":"Adjust spice level to taste.","pre_reqs":["Chop all vegetables evenly","Preheat saucepan over medium heat"],"total_time":35,"ingredients":[{"name":"mixed vegetables","ucum-unit":"cup_us","ucum-amount":4,"metric-unit":"g","metric-amount":400,"notes":"diced evenly"},{"name":"coconut milk","ucum-unit":"cup_us","ucum-amount":2,"metric-unit":"ml","metric-amount":480,"notes":"stirred well"},{"name":"curry paste","ucum-unit":"tbsp_us","ucum-amount":2,"metric-unit":"g","metric-amount":40,"notes":"added during sauté"}],"steps":["Sauté curry paste for 1 minute to release aroma.","Add vegetables and coat with paste.","Pour in coconut milk and simmer until vegetables are tender.","Serve hot with rice or naan."]},
        {"id":"5","title":"Roasted Chicken","image_url":"https://example.com/images/roast-chicken.jpg","description":"A perfectly seasoned, juicy roasted chicken with buttery flavor and tender meat.","notes":"Some people prefer to roast a whole chicken at 425°F (220°C) for 50–60 minutes to get crispier skin.","pre_reqs":["Preheat oven to 350°F (175°C)","Remove chicken from refrigerator an hour before cooking"],"total_time":90,"ingredients":[{"name":"whole chicken","ucum-unit":"cup_us","ucum-amount":6,"metric-unit":"g","metric-amount":1360,"notes":"3-pound whole chicken, giblets removed"},{"name":"salt and black pepper","ucum-unit":"tsp_us","ucum-amount":2,"metric-unit":"g","metric-amount":10,"notes":"to taste"},{"name":"onion powder","ucum-unit":"tbsp_us","ucum-amount":1,"metric-unit":"g","metric-amount":10,"notes":"or to taste"},{"name":"butter","ucum-unit":"cup_us","ucum-amount":0.5,"metric-unit":"g","metric-amount":115,"notes":"divided, 3 tablespoons for cavity, remainder for outside","allergen-code":"MILK"},{"name":"celery","ucum-unit":"cup_us","ucum-amount":0.5,"metric-unit":"g","metric-amount":50,"notes":"1 stalk, leaves removed, cut into 3 or 4 pieces"}],"steps":["Place chicken in a roasting pan and season inside and out with salt, pepper, and onion powder.","Place 3 tablespoons of butter inside the cavity and spread the remaining butter over the skin.","Cut celery into 3–4 pieces and place inside the cavity.","Roast uncovered for about 75 minutes until juices run clear and internal temperature reaches 165°F (74°C).","Remove from oven, baste with drippings, cover with foil, and rest for 30 minutes before serving."]}
      ];
    }

    function loadRecipes() {
      console.log('Checking localStorage...');
      const stored = localStorage.getItem(STORAGE_KEY);
      
      if (stored) {
        try {
          const recipes = JSON.parse(stored);
          console.log('✅ Recipes loaded from localStorage (' + recipes.length + ' recipes)');
          return recipes;
        } catch (e) {
          console.error('Failed to parse stored recipes:', e);
          return getInitialRecipes();
        }
      }
      
      console.log('No recipes found in localStorage, seeding with initial data');
      const initial = getInitialRecipes();
      saveRecipes(initial);
      console.log('✅ Initial recipes saved to localStorage (' + initial.length + ' recipes)');
      return initial;
    }

    function saveRecipes(recipes) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(recipes));
      console.log('💾 Saved ' + recipes.length + ' recipes to localStorage');
    }

    function renderRecipes(recipes) {
      const listEl = document.getElementById('recipesList');
      
      if (!recipes || recipes.length === 0) {
        listEl.innerHTML = '<div class="empty-state"><p>No recipes available.</p></div>';
        return;
      }
      
      listEl.innerHTML = '';
      
      recipes.forEach(recipe => {
        const card = document.createElement('div');
        card.className = 'recipe-card';
        
        const headerEl = document.createElement('div');
        headerEl.className = 'recipe-header';
        
        const titleEl = document.createElement('div');
        titleEl.className = 'recipe-title';
        titleEl.textContent = recipe.title || 'Untitled Recipe';
        
        const metaEl = document.createElement('div');
        metaEl.className = 'recipe-meta';
        
        const timeSpan = document.createElement('span');
        timeSpan.textContent = '⏱ ' + (recipe.total_time || 0) + ' min';
        metaEl.appendChild(timeSpan);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'Delete';
        deleteBtn.dataset.recipeId = recipe.id;
        
        headerEl.appendChild(titleEl);
        headerEl.appendChild(metaEl);
        headerEl.appendChild(deleteBtn);
        
        const bodyEl = document.createElement('div');
        bodyEl.className = 'recipe-body';
        
        if (recipe.description) {
          const descEl = document.createElement('div');
          descEl.className = 'recipe-description';
          descEl.textContent = recipe.description;
          bodyEl.appendChild(descEl);
        }
        
        if (recipe.notes) {
          const notesEl = document.createElement('div');
          notesEl.className = 'recipe-notes';
          notesEl.textContent = recipe.notes;
          bodyEl.appendChild(notesEl);
        }
        
        if (recipe.pre_reqs && recipe.pre_reqs.length > 0) {
          const preReqSection = document.createElement('div');
          preReqSection.className = 'recipe-section';
          
          const preReqTitle = document.createElement('div');
          preReqTitle.className = 'section-title';
          preReqTitle.textContent = 'Pre-requisites';
          preReqSection.appendChild(preReqTitle);
          
          const preReqList = document.createElement('ul');
          preReqList.className = 'section-list';
          recipe.pre_reqs.forEach(pr => {
            const li = document.createElement('li');
            li.textContent = pr;
            preReqList.appendChild(li);
          });
          preReqSection.appendChild(preReqList);
          bodyEl.appendChild(preReqSection);
        }
        
        if (recipe.ingredients && recipe.ingredients.length > 0) {
          const ingredientsSection = document.createElement('div');
          ingredientsSection.className = 'recipe-section';
          
          const ingredientsTitle = document.createElement('div');
          ingredientsTitle.className = 'section-title';
          ingredientsTitle.textContent = 'Ingredients';
          ingredientsSection.appendChild(ingredientsTitle);
          
          const ingredientsList = document.createElement('ul');
          ingredientsList.className = 'section-list';
          recipe.ingredients.forEach(ing => {
            const li = document.createElement('li');
            li.className = 'ingredients-item';
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'ingredient-name';
            nameSpan.textContent = ing.name || 'Unknown';
            
            if (ing['allergen-code']) {
              const allergenBadge = document.createElement('span');
              allergenBadge.className = 'allergen-badge';
              allergenBadge.textContent = ing['allergen-code'];
              nameSpan.appendChild(allergenBadge);
            }
            
            const amountSpan = document.createElement('span');
            amountSpan.className = 'ingredient-amount';
            amountSpan.textContent = (ing['metric-amount'] || 0) + (ing['metric-unit'] || '');
            
            li.appendChild(nameSpan);
            li.appendChild(amountSpan);
            ingredientsList.appendChild(li);
          });
          ingredientsSection.appendChild(ingredientsList);
          bodyEl.appendChild(ingredientsSection);
        }
        
        if (recipe.steps && recipe.steps.length > 0) {
          const stepsSection = document.createElement('div');
          stepsSection.className = 'recipe-section';
          
          const stepsTitle = document.createElement('div');
          stepsTitle.className = 'section-title';
          stepsTitle.textContent = 'Steps';
          stepsSection.appendChild(stepsTitle);
          
          const stepsList = document.createElement('ol');
          stepsList.className = 'steps-list';
          recipe.steps.forEach(step => {
            const li = document.createElement('li');
            li.textContent = step;
            stepsList.appendChild(li);
          });
          stepsSection.appendChild(stepsList);
          bodyEl.appendChild(stepsSection);
        }
        
        card.appendChild(headerEl);
        card.appendChild(bodyEl);
        listEl.appendChild(card);
      });
    }

    function addRecipe() {
      const textarea = document.getElementById('recipeJsonInput');
      const jsonText = textarea.value.trim();
      
      if (!jsonText) {
        alert('Please enter recipe JSON');
        return;
      }
      
      try {
        const newRecipe = JSON.parse(jsonText);
        const recipes = loadRecipes();
        
        newRecipe.id = (recipes.length + 1).toString();
        recipes.push(newRecipe);
        
        console.log('Adding recipe: ' + newRecipe.title);
        saveRecipes(recipes);
        console.log('✅ Recipe added, saved to localStorage (' + recipes.length + ' recipes)');
        
        renderRecipes(recipes);
        textarea.value = '';
      } catch (e) {
        console.error('Invalid JSON:', e);
        alert('Invalid JSON: ' + e.message);
      }
    }

    function deleteRecipe(id) {
      console.log('Deleting recipe ID: ' + id);
      const recipes = loadRecipes();
      const filtered = recipes.filter(r => r.id !== id);
      
      saveRecipes(filtered);
      console.log('✅ Recipe deleted, saved to localStorage (' + filtered.length + ' recipes)');
      
      renderRecipes(filtered);
    }

    document.getElementById('recipesList').addEventListener('click', function(e) {
      if (e.target && e.target.classList.contains('delete-btn')) {
        const recipeId = e.target.dataset.recipeId;
        if (recipeId) {
          deleteRecipe(recipeId);
        }
      }
    });

    document.getElementById('addRecipeBtn').addEventListener('click', addRecipe);

    document.addEventListener('DOMContentLoaded', function() {
      console.log('✅ Page loaded and DOM ready');
      const recipes = loadRecipes();
      renderRecipes(recipes);
    });
  </script>
</body>
</html>
